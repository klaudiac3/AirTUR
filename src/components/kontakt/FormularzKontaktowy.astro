---
import { companyConfig } from '../../data/companyConfig';
---

<section class="pt-8 pb-16 md:pb-24 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <div class="grid grid-cols-1 lg:grid-cols-5 bg-white shadow-2xl rounded-3xl overflow-hidden">
      
      <div class="lg:col-span-3 p-8 md:p-12 lg:p-16">
        
        <h2 class="text-3xl font-bold text-airtur-dark mb-8">Formularz Kontaktowy</h2>
        
        <form 
          id="main-contact-form"
          name="kontakt-glowny" 
          method="POST" 
          class="space-y-6"
          novalidate
        >
          <input type="hidden" name="form-name" value="kontakt-glowny" />
          <input type="hidden" name="source" value="strona_kontaktowa_glowna" />
          <input type="hidden" name="cel" value="kontakt" />
          
          <div>
            <label for="name" class="block text-sm font-bold text-gray-700 mb-1">Imiƒô i Nazwisko <span class="text-airtur-blue">*</span></label>
            <input type="text" id="name" name="imie" required 
              class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-white" 
              placeholder="Jan Kowalski">
            <div id="err-imie" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">Imiƒô musi mieƒá minimum 3 znaki.</div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative">
            <div>
              <label for="email" class="block text-sm font-bold text-gray-700 mb-1">Adres e-mail</label>
              <input type="email" id="email" name="email" 
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-white" 
                placeholder="jan@przyklad.pl">
              <p class="text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter">Wygodna opcja dla zapyta≈Ñ ofertowych</p>
              <div id="err-email" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">Proszƒô podaƒá poprawny adres e-mail.</div>
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-bold text-gray-700 mb-1">Numer telefonu</label>
              <input type="tel" id="phone" name="telefon" 
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-white" 
                placeholder="+48 000 000 000">
              <p class="text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter">Dla szybkiego kontaktu telefonicznego</p>
              <div id="err-telefon" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">Numer telefonu musi mieƒá minimum 9 cyfr.</div>
            </div>

            <div id="contact-error" class="hidden absolute -bottom-5 left-0 text-red-500 text-[10px] font-bold italic">
                Proszƒô podaƒá przynajmniej jednƒÖ, poprawnƒÖ formƒô kontaktu.
            </div>
          </div>

          <div>
            <label for="message" class="block text-sm font-bold text-gray-700 mb-1">Tre≈õƒá wiadomo≈õci (Opcjonalne)</label>
            <textarea id="message" name="wiadomosc" rows="5" 
              class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-white" 
              placeholder="Dzie≈Ñ dobry, interesuje mnie [monta≈º / serwis] w miejscowo≈õci‚Ä¶&#10;M√≥j przybli≈ºony metra≈º to..."></textarea>
          </div>

          <div class="flex flex-col pt-2">
            <div class="flex items-start">
                <div class="flex items-center h-5">
                <input id="consent" name="zgoda" type="checkbox" required class="w-5 h-5 text-airtur-blue border-gray-300 rounded focus:ring-airtur-blue cursor-pointer">
                </div>
                <div class="ml-3 text-sm">
                <label for="consent" class="text-gray-600 cursor-pointer">
                    Akceptujƒô <a href="/regulamin" class="text-airtur-blue hover:underline font-semibold">Regulamin</a> oraz wyra≈ºam zgodƒô na przetwarzanie moich danych zgodnie z <a href="/polityka-prywatnosci" class="text-airtur-blue hover:underline font-semibold">PolitykƒÖ Prywatno≈õci</a>.
                </label>
                </div>
            </div>
            <div id="err-zgoda" class="hidden text-red-500 text-xs font-bold mt-2 pl-1">Akceptacja Regulaminu oraz Polityki Prywatno≈õci jest wymagana.</div>
          </div>

          <div class="pt-4">
            <button type="submit" class="submit-btn w-full bg-airtur-blue text-white font-bold py-4 rounded-xl hover:bg-opacity-90 transition shadow-lg uppercase tracking-wide transform hover:-translate-y-0.5 cursor-pointer">
              WY≈öLIJ WIADOMO≈öƒÜ
            </button>
            <p class="text-xs text-gray-400 text-center mt-4">
              * Imiƒô i Nazwisko oraz przynajmniej jedna forma kontaktu sƒÖ wymagane.
            </p>
          </div>

        </form>
      </div>

      <div class="lg:col-span-2 flex flex-col">
        
        <div class="bg-airtur-dark p-8 md:p-10 text-white">
          <h2 class="text-2xl md:text-3xl font-bold mb-4">Zadzwo≈Ñ ju≈º teraz</h2>
          <p class="text-gray-300 mb-8 text-sm md:text-base">Wolisz kontakt bezpo≈õredni? Zadzwo≈Ñ do nas lub napisz e-mail.</p>
          
          <div class="space-y-6">
            <a href={companyConfig.contact.phoneLink} class="flex items-center gap-4 group">
              <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center group-hover:bg-airtur-blue transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-white">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
                </svg>
              </div>
              <div>
                <p class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-0.5">Telefon</p>
                <p class="text-xl font-bold text-white group-hover:text-airtur-blue transition-colors">{companyConfig.contact.phoneFull}</p>
              </div>
            </a>

            <a href={companyConfig.contact.emailLink} class="flex items-center gap-4 group">
              <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center group-hover:bg-airtur-blue transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-white">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25 2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                </svg>
              </div>
              <div>
                <p class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-0.5">E-mail</p>
                <p class="text-xl font-bold text-white group-hover:text-airtur-blue transition-colors">{companyConfig.contact.email}</p>
              </div>
            </a>
          </div>
        </div>

        <div class="bg-white p-8 md:p-10 flex-grow flex flex-col justify-between border-t lg:border-t-0 lg:border-l border-gray-100">
          <div class="space-y-8">
            <div>
              <h3 class="text-xl font-bold text-airtur-dark mb-4">Dane Firmy:</h3>
              <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-airtur-blue">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                  </svg>
                </div>
                <div class="text-gray-600 text-sm leading-relaxed">
                  <p class="font-bold text-airtur-dark text-base">{companyConfig.name}</p>
                  <p>{companyConfig.address.street}</p>
                  <p>{companyConfig.address.postCode} {companyConfig.address.city}</p>
                </div>
              </div>
            </div>

            <div>
              <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-airtur-blue">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                  </svg>
                </div>
                <div>
                  <p class="font-bold text-airtur-dark mb-1 text-base">Godziny otwarcia biura:</p>
                  <div class="text-gray-600 text-sm space-y-1">
                    <p><span class="font-medium">Pn ‚Äì Pt:</span> {companyConfig.workingHours.weekdays}</p>
                    <p><span class="font-medium">Sobota:</span> {companyConfig.workingHours.saturday}</p>
                    <p><span class="font-medium">Niedziela:</span> {companyConfig.workingHours.sunday}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-10 pt-6 border-t border-gray-100">
            <p class="font-bold text-airtur-dark mb-2">{companyConfig.fullName}</p>
            <div class="flex flex-col gap-1 text-xs text-gray-500">
              <p>NIP: {companyConfig.nip}</p>
              <p>REGON: {companyConfig.regon}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
      console.log("üöÄ KONTAKT DOM READY: Szukam formularza...");

      const form = document.getElementById('main-contact-form');
      
      // Walidatory
      const isValidEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const isValidPhone = (phone) => phone.replace(/\D/g, "").length >= 9;

      if (!form) {
          console.error("‚ùå B≈ÅƒÑD: Nie znaleziono formularza #main-contact-form");
          return;
      }

      form.addEventListener('submit', async (e) => {
          e.preventDefault();
          console.log("üöÄ SUBMIT EVENT Z≈ÅAPANY!");

          const targetForm = e.currentTarget;
          const submitBtn = targetForm.querySelector('.submit-btn');
          const originalBtnText = submitBtn?.innerText || "WY≈öLIJ WIADOMO≈öƒÜ";

          // Elementy formularza
          const nameInput = targetForm.querySelector('input[name="imie"]');
          const emailInput = targetForm.querySelector('input[name="email"]');
          const phoneInput = targetForm.querySelector('input[name="telefon"]');
          const consentInput = targetForm.querySelector('input[name="zgoda"]');

          // Elementy b≈Çƒôd√≥w
          const errName = document.getElementById('err-imie');
          const errEmail = document.getElementById('err-email');
          const errPhone = document.getElementById('err-telefon');
          const errConsent = document.getElementById('err-zgoda');
          const errGeneral = document.getElementById('contact-error');

          let hasError = false;

          // 1. Walidacja Imienia
          if (nameInput.value.trim().length < 3) {
             hasError = true;
             nameInput.classList.add('border-red-400', 'bg-red-50');
             nameInput.classList.remove('border-gray-300');
             if(errName) errName.classList.remove('hidden');
          }

          // 2. Walidacja Formy kontaktu (Oba puste?)
          const emailVal = emailInput.value.trim();
          const phoneVal = phoneInput.value.trim();

          if (!emailVal && !phoneVal) {
              hasError = true;
              if(errGeneral) errGeneral.classList.remove('hidden');
          } 
          
          // 3. Walidacja konkretnych p√≥l je≈õli sƒÖ wype≈Çnione
          // EMAIL
          if (emailVal && !isValidEmail(emailVal)) {
              hasError = true;
              emailInput.classList.add('border-red-400', 'bg-red-50');
              emailInput.classList.remove('border-gray-300');
              if(errEmail) errEmail.classList.remove('hidden');
          }
          // TELEFON
          if (phoneVal && !isValidPhone(phoneVal)) {
              hasError = true;
              phoneInput.classList.add('border-red-400', 'bg-red-50');
              phoneInput.classList.remove('border-gray-300');
              if(errPhone) errPhone.classList.remove('hidden');
          }

          // 4. Walidacja Zgody
          if (!consentInput.checked) {
              hasError = true;
              if(errConsent) errConsent.classList.remove('hidden');
          }

          // STOP JE≈öLI B≈ÅƒòDY
          if (hasError) return;

          // --- LOGIKA WYSY≈ÅKI ---
          if (submitBtn) {
              submitBtn.disabled = true;
              submitBtn.innerText = "WYSY≈ÅANIE...";
          }

          const formData = new FormData(targetForm);
          const dataObj = Object.fromEntries(formData.entries());

          try {
              console.log("üì° Wysy≈Çam fetch do /api/send-form...");

              const response = await fetch('/api/send-form', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(dataObj)
              });

              console.log("üì° Status odpowiedzi:", response.status);

              if (!response.ok) {
                  const errorText = await response.text();
                  console.error("‚ùå B≈ÇƒÖd serwera tre≈õƒá:", errorText);
                  throw new Error(`B≈ÇƒÖd serwera: ${response.status}`);
              }

              console.log("‚úÖ SUKCES! Przekierowanie...");
              
              // <<< TUTAJ JEST TWOJA ZMIANA Z POPRAWIONYM LINKIEM >>>
              window.location.assign('/podziekowanie/?cel=kontakt');

          } catch (error) {
              console.error("‚ùå B≈ÅƒÑD WYSY≈ÅKI (CATCH):", error);
              alert("WystƒÖpi≈Ç b≈ÇƒÖd podczas wysy≈Çania. Spr√≥buj ponownie lub zadzwo≈Ñ bezpo≈õrednio.");
              
              if (submitBtn) {
                  submitBtn.disabled = false;
                  submitBtn.innerText = originalBtnText;
              }
          }
      });

      // --- CZYSZCZENIE B≈ÅƒòD√ìW W CZASIE RZECZYWISTYM ---
      // Uniwersalny handler dla input√≥w tekstowych
      const inputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
      inputs.forEach(input => {
         input.addEventListener('input', () => {
             // 1. Usu≈Ñ czerwone ramki
             input.classList.remove('border-red-400', 'bg-red-50');
             input.classList.add('border-gray-300'); 
             
             // 2. Ukryj b≈ÇƒÖd dedykowany dla tego pola (szukamy po ID w pobli≈ºu)
             // Zak≈Çadamy strukturƒô: input #name -> b≈ÇƒÖd #err-imie
             let errId = '';
             if (input.name === 'imie') errId = 'err-imie';
             else if (input.name === 'email') errId = 'err-email';
             else if (input.name === 'telefon') errId = 'err-telefon';

             if(errId) {
                const errDiv = document.getElementById(errId);
                if(errDiv) errDiv.classList.add('hidden');
             }

             // 3. Je≈õli u≈ºytkownik wpisuje cokolwiek w email lub telefon, ukryj b≈ÇƒÖd og√≥lny
             if (input.name === 'email' || input.name === 'telefon') {
                 const errGeneral = document.getElementById('contact-error');
                 if(errGeneral) errGeneral.classList.add('hidden');
             }
         });
      });

      // Handler dla checkboxa zgody
      const consentBox = form.querySelector('input[name="zgoda"]');
      if(consentBox) {
          consentBox.addEventListener('change', () => {
              const errConsent = document.getElementById('err-zgoda');
              if(errConsent) errConsent.classList.add('hidden');
          });
      }
  });
</script>