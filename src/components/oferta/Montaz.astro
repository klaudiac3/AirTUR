---
// src/components/oferta/Montaz.astro
import { companyConfig } from '../../data/companyConfig';
---

<section id="montaz" class="py-12 md:py-20 bg-white scroll-mt-24">
  
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-4xl font-bold text-airtur-dark">
        Precyzyjny MontaÅ¼ i Zasada Idealnego PorzÄ…dku
      </h2>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 lg:gap-12 mb-16 items-stretch">
      
      <div class="w-full lg:w-1/2 min-h-[300px]">
        <img 
          src="/montaz.jpg" 
          alt="Instalator AirTUR podczas pracy" 
          class="w-full h-full object-cover rounded-xl shadow-lg"
        />
      </div>

      <div class="w-full lg:w-1/2 flex flex-col justify-center">
        <p class="text-lg text-gray-600 leading-relaxed">
          Nasza filozofia montaÅ¼u opiera siÄ™ na trzech filarach: precyzji, porzÄ…dku i terminowoÅ›ci. DoÅ›wiadczenie zdobyte na najbardziej wymagajÄ…cych rynkach europejskich nauczyÅ‚o nas, Å¼e jakoÅ›Ä‡ tkwi w detalach. <br><br>
          KaÅ¼dy montaÅ¼ traktujemy z najwyÅ¼szym szacunkiem dla Twojego domu â€“ naszym celem jest, aby caÅ‚y proces przebiegÅ‚ sprawnie, bez baÅ‚aganu i niepotrzebnego stresu.
        </p>
      </div>

    </div>

  </div>

  <div class="bg-gray-50 py-12 border-y border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      
      <h3 class="text-2xl font-bold text-airtur-dark mb-10">
        Nasz Proces â€“ TwÃ³j SpokÃ³j w 5 Krokach
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-8">
        
        <div class="flex flex-col items-center">
          <div class="w-12 h-12 rounded-full bg-airtur-blue text-white flex items-center justify-center text-xl font-bold mb-3 shadow-md">1</div>
          <h4 class="font-bold text-lg text-airtur-dark mb-1">Analiza i audyt</h4>
          <p class="text-sm text-gray-600 leading-relaxed">Zaczynamy od zrozumienia Twoich celÃ³w i warunkÃ³w technicznych, a nie od wyboru urzÄ…dzenia.</p>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-12 h-12 rounded-full bg-airtur-blue text-white flex items-center justify-center text-xl font-bold mb-3 shadow-md">2</div>
          <h4 class="font-bold text-lg text-airtur-dark mb-1">Kalkulacja ROI</h4>
          <p class="text-sm text-gray-600 leading-relaxed">Otrzymujesz od nas oparte na danych szacunki zwrotu z inwestycji (ROI) oraz finalnÄ…, szczegÃ³Å‚owÄ… wycenÄ™.</p>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-12 h-12 rounded-full bg-airtur-blue text-white flex items-center justify-center text-xl font-bold mb-3 shadow-md">3</div>
          <h4 class="font-bold text-lg text-airtur-dark mb-1">DobÃ³r systemu</h4>
          <p class="text-sm text-gray-600 leading-relaxed">Rekomendujemy wyÅ‚Ä…cznie sprawdzone urzÄ…dzenia, ktÃ³re zapewniajÄ… najlepszy zwrot z inwestycji.</p>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-12 h-12 rounded-full bg-airtur-blue text-white flex items-center justify-center text-xl font-bold mb-3 shadow-md">4</div>
          <h4 class="font-bold text-lg text-airtur-dark mb-1">Czysty montaÅ¼</h4>
          <p class="text-sm text-gray-600 leading-relaxed">JesteÅ›my w umÃ³wionym dniu i rygorystycznie przestrzegamy naszej Zasady Idealnego PorzÄ…dku.</p>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-12 h-12 rounded-full bg-airtur-blue text-white flex items-center justify-center text-xl font-bold mb-3 shadow-md">5</div>
          <h4 class="font-bold text-lg text-airtur-dark mb-1">InstruktaÅ¼</h4>
          <p class="text-sm text-gray-600 leading-relaxed">Nie zostawiamy CiÄ™ z samym pilotem. Uczymy peÅ‚nej kontroli nad systemem i dbaniem o filtry.</p>
        </div>

      </div>

    </div>
  </div>

  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mt-16">
    
    <div class="text-center mb-8">
      <h3 class="text-2xl font-bold text-airtur-dark">
        Masz pytania dotyczÄ…ce montaÅ¼u? Wybierz formÄ™ kontaktu:
      </h3>
    </div>

    <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
      
      <button id="tab-email" class="w-full sm:w-auto px-6 py-3 rounded-lg border-2 border-airtur-dark text-sm font-bold uppercase tracking-wide transition-all bg-airtur-dark text-white shadow-lg cursor-pointer">
        ChcÄ™ napisaÄ‡ e-mail
      </button>
      
      <button id="tab-phone" class="w-full sm:w-auto px-6 py-3 rounded-lg border-2 border-airtur-dark text-sm font-bold uppercase tracking-wide transition-all bg-white text-airtur-dark hover:bg-gray-100 cursor-pointer">
        PreferujÄ™ kontakt telefoniczny
      </button>

    </div>

    <div id="form-email" class="bg-white p-6 md:p-8 rounded-2xl shadow-xl border border-gray-200">
      <form 
        id="montaz-form-mail"
        name="zapytanie-montaz-mail" 
        method="POST" 
        class="space-y-4"
        novalidate
      >
        <input type="hidden" name="form-name" value="zapytanie-montaz-mail" />
        <input type="hidden" name="source" value="oferta_montaz_email" />
        <input type="hidden" name="cel" value="montaz" />

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="name-mail" class="block text-sm font-bold text-airtur-dark mb-1">ImiÄ™</label>
            <input type="text" id="name-mail" name="imie" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-gray-50" placeholder="Wpisz swoje imiÄ™">
            <div id="err-imie-mail" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">ImiÄ™ musi mieÄ‡ minimum 3 znaki.</div>
          </div>
          <div>
            <label for="email-field" class="block text-sm font-bold text-airtur-dark mb-1">E-mail</label>
            <input type="email" id="email-field" name="email" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-gray-50" placeholder="twoj@email.pl">
            <div id="err-email-mail" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">ProszÄ™ podaÄ‡ poprawny adres e-mail.</div>
          </div>
        </div>
        
        <div>
          <label for="message-mail" class="block text-sm font-bold text-airtur-dark mb-1">TreÅ›Ä‡ wiadomoÅ›ci</label>
          <textarea 
            id="message-mail" 
            name="wiadomosc"
            rows="5" 
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-gray-50 text-gray-700 placeholder-gray-400"
            placeholder="DzieÅ„ dobry,&#10;ProszÄ™ o przygotowanie analizy i oferty na montaÅ¼.&#10;Moja lokalizacja: [np. Dom w okolicy Nowego SÄ…cza]&#10;Powierzchnia pomieszczenia: [np. ok. 30 mÂ²]&#10;MÃ³j gÅ‚Ã³wny cel to: [np. OszczÄ™dnoÅ›Ä‡ na ogrzewaniu / ChÅ‚odzenie latem]"
          ></textarea>
        </div>

        <div class="flex flex-col pt-2">
            <div class="flex items-start">
                <div class="flex items-center h-5">
                  <input 
                    id="consent-montaz-mail" 
                    name="zgoda" 
                    type="checkbox" 
                    required 
                    class="w-5 h-5 text-airtur-blue border-gray-300 rounded focus:ring-airtur-blue cursor-pointer"
                  >
                </div>
                <div class="ml-3 text-sm leading-snug">
                  <label for="consent-montaz-mail" class="text-gray-600 cursor-pointer">
                    AkceptujÄ™ <a href="/regulamin" class="text-airtur-blue hover:underline font-semibold">Regulamin</a> oraz wyraÅ¼am zgodÄ™ na przetwarzanie danych osobowych zgodnie z <a href="/polityka-prywatnosci" class="text-airtur-blue hover:underline font-semibold">PolitykÄ… PrywatnoÅ›ci</a> w celu obsÅ‚ugi zapytania ofertowego.
                  </label>
                </div>
            </div>
            <div id="err-zgoda-mail" class="hidden text-red-500 text-xs font-bold mt-2 pl-1">Akceptacja Regulaminu oraz Polityki PrywatnoÅ›ci jest wymagana.</div>
        </div>

        <button type="submit" class="submit-btn w-full bg-airtur-blue text-white font-bold py-3 rounded-lg hover:bg-opacity-90 transition shadow-md uppercase tracking-wide cursor-pointer">
          WYÅšLIJ WIADOMOÅšÄ†
        </button>
      </form>
    </div>

    <div id="form-phone" class="hidden bg-white p-6 md:p-8 rounded-2xl shadow-xl border border-gray-200">
      <form 
        id="montaz-form-phone"
        name="zapytanie-montaz-phone" 
        method="POST" 
        class="space-y-4"
        novalidate
      >
        <input type="hidden" name="form-name" value="zapytanie-montaz-phone" />
        <input type="hidden" name="source" value="oferta_montaz_telefon" />
        <input type="hidden" name="cel" value="montaz" />

        <div class="text-center mb-6 bg-blue-50 p-3 rounded-lg border border-blue-100">
            <p class="text-airtur-dark font-medium text-sm">Zostaw swÃ³j numer. Oddzwonimy, by omÃ³wiÄ‡ szczegÃ³Å‚y montaÅ¼u.</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
            <label for="name-phone" class="block text-sm font-bold text-airtur-dark mb-1">ImiÄ™</label>
            <input type="text" id="name-phone" name="imie" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-gray-50" placeholder="Wpisz swoje imiÄ™">
            <div id="err-imie-phone" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">ImiÄ™ musi mieÄ‡ minimum 3 znaki.</div>
            </div>
            <div>
            <label for="phone-field" class="block text-sm font-bold text-airtur-dark mb-1">Numer telefonu</label>
            <input type="tel" id="phone-field" name="telefon" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-airtur-blue focus:ring-2 focus:ring-airtur-blue/20 outline-none transition bg-gray-50" placeholder="+48 ...">
            <div id="err-telefon-phone" class="hidden text-red-500 text-xs font-bold mt-1 ml-1">Numer telefonu musi mieÄ‡ minimum 9 cyfr.</div>
            </div>
        </div>

        <div class="flex flex-col pt-2">
            <div class="flex items-start">
                <div class="flex items-center h-5">
                  <input id="consent-montaz-phone" name="zgoda" type="checkbox" required class="w-5 h-5 text-airtur-blue border-gray-300 rounded focus:ring-airtur-blue cursor-pointer">
                </div>
                <div class="ml-3 text-sm leading-snug">
                  <label for="consent-montaz-phone" class="text-gray-600 cursor-pointer">
                    AkceptujÄ™ <a href="/regulamin" class="text-airtur-blue hover:underline font-semibold">Regulamin</a> oraz wyraÅ¼am zgodÄ™ na przetwarzanie danych osobowych zgodnie z <a href="/polityka-prywatnosci" class="text-airtur-blue hover:underline font-semibold">PolitykÄ… PrywatnoÅ›ci</a> w celu kontaktu telefonicznego.
                  </label>
                </div>
            </div>
            <div id="err-zgoda-phone" class="hidden text-red-500 text-xs font-bold mt-2 pl-1">Akceptacja Regulaminu oraz Polityki PrywatnoÅ›ci jest wymagana.</div>
        </div>

        <button type="submit" class="submit-btn w-full bg-airtur-dark text-white font-bold py-3 rounded-lg hover:bg-opacity-90 transition shadow-md uppercase tracking-wide cursor-pointer">
          PROSZÄ˜ O TELEFON
        </button>
      </form>
    </div>

  </div>
</section>

<script is:inline>
  // Wersja PRO: UÅ¼ywamy DOMContentLoaded (szybciej niÅ¼ load, bezpieczniej niÅ¼ sam skrypt)
  document.addEventListener('DOMContentLoaded', () => {
      console.log("ğŸš€ DOM READY: HTML zaÅ‚adowany, szukam formularzy...");

      // WybÃ³r formularzy po ID (zostawiamy ID, Å¼eby nie psuÄ‡ stylÃ³w CSS, jeÅ›li sÄ… na nich oparte)
      const forms = document.querySelectorAll('#montaz-form-mail, #montaz-form-phone');
      
      // Elementy tabÃ³w
      const tabEmail = document.getElementById('tab-email');
      const tabPhone = document.getElementById('tab-phone');
      const formEmailContainer = document.getElementById('form-email');
      const formPhoneContainer = document.getElementById('form-phone');

      // DIAGNOSTYKA
      console.log(`ğŸ” ZNALEZIONO FORMULARZY: ${forms.length}`);
      if (forms.length === 0) console.error("âŒ BÅÄ„D KRYTYCZNY: Nie widzÄ™ formularzy w DOM!");

      // --- LOGIKA TABÃ“W (Bez zmian - dziaÅ‚a dobrze) ---
      const activeClassAdd = ['bg-airtur-dark', 'text-white'];
      const activeClassRemove = ['bg-white', 'text-airtur-dark', 'hover:bg-gray-100'];
      const inactiveClassAdd = ['bg-white', 'text-airtur-dark', 'hover:bg-gray-100'];
      const inactiveClassRemove = ['bg-airtur-dark', 'text-white'];

      if(tabEmail && tabPhone) {
          tabEmail.addEventListener('click', () => {
            formEmailContainer?.classList.remove('hidden');
            formPhoneContainer?.classList.add('hidden');
            tabEmail.classList.add(...activeClassAdd);
            tabEmail.classList.remove(...activeClassRemove);
            tabPhone?.classList.add(...inactiveClassAdd);
            tabPhone?.classList.remove(...inactiveClassRemove);
          });

          tabPhone.addEventListener('click', () => {
            formPhoneContainer?.classList.remove('hidden');
            formEmailContainer?.classList.add('hidden');
            tabPhone.classList.add(...activeClassAdd);
            tabPhone.classList.remove(...activeClassRemove);
            tabEmail?.classList.add(...inactiveClassAdd);
            tabEmail?.classList.remove(...inactiveClassRemove);
          });
      }

      // --- LOGIKA WYSYÅKI (SENIOR LEVEL) ---
      const isValidEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const isValidPhone = (phone) => phone.replace(/\D/g, "").length >= 9;

      forms.forEach(form => {
          console.log(`ğŸ”§ Podpinam listener pod formularz: ${form.id}`);
          
          form.addEventListener('submit', async (e) => {
              e.preventDefault(); // STOP PRZEÅADOWANIU
              console.log("ğŸš€ SUBMIT EVENT ZÅAPANY!");

              // SENIOR FIX: currentTarget to pewnoÅ›Ä‡, Å¼e mamy <form>, a nie coÅ› w Å›rodku
              const targetForm = e.currentTarget; 
              const submitBtn = targetForm.querySelector('.submit-btn');
              
              const suffix = targetForm.id === 'montaz-form-mail' ? 'mail' : 'phone';
              let hasError = false;

              // 1. Walidacja Imienia (wspÃ³lna dla obu)
              const nameInput = targetForm.querySelector('input[name="imie"]');
              const nameErr = document.getElementById(`err-imie-${suffix}`);
              if (nameInput.value.trim().length < 3) {
                  hasError = true;
                  nameInput.classList.add('border-red-400', 'bg-red-50');
                  nameInput.classList.remove('border-gray-300');
                  if(nameErr) nameErr.classList.remove('hidden');
              }

              // 2. Walidacja Emaila lub Telefonu
              if (suffix === 'mail') {
                  const emailInput = targetForm.querySelector('input[name="email"]');
                  const emailErr = document.getElementById(`err-email-mail`);
                  if (!isValidEmail(emailInput.value)) {
                      hasError = true;
                      emailInput.classList.add('border-red-400', 'bg-red-50');
                      emailInput.classList.remove('border-gray-300');
                      if(emailErr) emailErr.classList.remove('hidden');
                  }
              } else {
                  const phoneInput = targetForm.querySelector('input[name="telefon"]');
                  const phoneErr = document.getElementById(`err-telefon-phone`);
                  if (!isValidPhone(phoneInput.value)) {
                      hasError = true;
                      phoneInput.classList.add('border-red-400', 'bg-red-50');
                      phoneInput.classList.remove('border-gray-300');
                      if(phoneErr) phoneErr.classList.remove('hidden');
                  }
              }

              // 3. Walidacja Zgody
              const consentInput = targetForm.querySelector('input[name="zgoda"]');
              const consentErr = document.getElementById(`err-zgoda-${suffix}`);
              if (!consentInput.checked) {
                  hasError = true;
                  if(consentErr) consentErr.classList.remove('hidden');
              }

              // STOP JEÅšLI BÅÄ˜DY
              if (hasError) return;

              // --- WYSYÅKA ---
              // SENIOR FIX: Optional Chaining (?.) - jak nie znajdzie tekstu, to siÄ™ nie wywali
              const originalBtnText = submitBtn?.innerText || "WYÅšLIJ";
              
              if (submitBtn) {
                  submitBtn.disabled = true;
                  submitBtn.innerText = "WYSYÅANIE...";
              }

              const formData = new FormData(targetForm);
              const dataObj = Object.fromEntries(formData.entries());

              try {
                  console.log("ğŸ“¡ WysyÅ‚am fetch do /api/send-form...");
                  
                  const response = await fetch('/api/send-form', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(dataObj)
                  });
                  
                  console.log("ğŸ“¡ Status odpowiedzi:", response.status);

                  if (!response.ok) {
                      const errorText = await response.text();
                      console.error("âŒ BÅ‚Ä…d serwera treÅ›Ä‡:", errorText);
                      throw new Error(`BÅ‚Ä…d serwera: ${response.status}`);
                  }

                  console.log("âœ… SUKCES! Przekierowanie...");
                  
                  // <<< TUTAJ JEST TWOJA ZMIANA Z POPRAWIONYM LINKIEM >>>
                  window.location.assign('/podziekowanie/?cel=montaz');

              } catch (error) {
                  console.error("âŒ BÅÄ„D WYSYÅKI (CATCH):", error);
                  alert(`WystÄ…piÅ‚ bÅ‚Ä…d: ${error.message}`);
                  
                  if(submitBtn) {
                      submitBtn.disabled = false;
                      submitBtn.innerText = originalBtnText;
                  }
              }
          });
      });

      // Czyszczenie bÅ‚Ä™dÃ³w przy pisaniu (uniwersalne)
      document.querySelectorAll('input, textarea').forEach(input => {
          input.addEventListener('input', () => {
              input.classList.remove('border-red-400', 'bg-red-50');
              input.classList.add('border-gray-300'); // PrzywrÃ³Ä‡ normalny border
              
              // ZnajdÅº i ukryj komunikat bÅ‚Ä™du powiÄ…zany z tym polem
              // Szukamy najbliÅ¼szego diva z bÅ‚Ä™dem w tym samym kontenerze lub po ID
              const parent = input.parentElement;
              const errorDiv = parent.querySelector('[id^="err-"]');
              if(errorDiv) errorDiv.classList.add('hidden');
          });
          
          // Ukryj bÅ‚Ä…d zgody po klikniÄ™ciu w checkbox
          if(input.type === 'checkbox') {
             input.addEventListener('change', () => {
                // ZnajdÅº kontener zgody i ukryj bÅ‚Ä…d w nim (lub obok)
                const form = input.closest('form');
                if(form) {
                    const suffix = form.id === 'montaz-form-mail' ? 'mail' : 'phone';
                    const consentErr = document.getElementById(`err-zgoda-${suffix}`);
                    if(consentErr) consentErr.classList.add('hidden');
                }
             });
          }
      });
  });
</script>