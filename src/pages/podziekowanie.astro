---
// src/pages/podziekowanie.astro
import Layout from '../layouts/Layout.astro';
import { companyConfig } from '../data/companyConfig';

export const prerender = true;


// KONFIGURACJA TRECI - Mapowanie parametr贸w URL na teksty
const contents = {
  kontakt: {
    title: "Dzikujemy za kontakt!",
    subtitle: "Twoje zapytanie jest ju偶 w analizie.",
    desc: "Nasz specjalista skontaktuje si z Tob w cigu maksymalnie 24 godzin roboczych.",
    pdfEnabled: true, 
    pdfType: 'static', 
    pdfFile: 'checklista-inwestora-airtur.pdf', 
    pdfLabel: 'Checklista wiadomego Inwestora',
    pdfDesc: '7 pyta, kt贸re musisz zada instalatorowi, aby unikn bd贸w.',
    navLink: '/baza-wiedzy',
    navLabel: 'Odwied藕 Baz Wiedzy'
  },
  montaz: {
    title: "Zgoszenie monta偶u przyjte",
    subtitle: "Rozpoczynamy przygotowanie audytu.",
    desc: "In偶ynier techniczny oddzwoni do Ciebie, aby um贸wi bezpatn wizj lokaln i om贸wi szczeg贸y instalacji.",
    pdfEnabled: true,
    pdfType: 'static',
    pdfFile: 'przewodnik-audyt-techniczny.pdf', 
    pdfLabel: 'Pobierz: Jak przygotowa dom do monta偶u? (PDF)',
    pdfDesc: 'Kr贸tki poradnik o tym, gdzie najlepiej umieci jednostki przed nasz wizyt.',
    navLink: '/narzedzia',
    navLabel: 'Oblicz oszczdnoci w Narzdziach'
  },
  serwis: {
    title: "Zgoszenie serwisowe zarejestrowane",
    subtitle: "Tw贸j komfort jest naszym priorytetem.",
    desc: "Technik odpowiedzialny za Tw贸j region skontaktuje si z Tob, aby ustali dogodny termin wizyty.",
    pdfEnabled: false,
    navLink: '/baza-wiedzy',
    navLabel: 'Jak dba o klimatyzacj? (Blog)'
  },
  // NOWE: Obsuga konkretnych wynik贸w kalkulatora
  ogrzewanie: {
    title: "Twoja Analiza Oszczdnoci Gotowa!",
    subtitle: "Ogrzewanie klimatyzacj to mdry wyb贸r.",
    desc: "Poni偶ej znajdziesz podsumowanie Twoich oszczdnoci. Raport PDF z detalami technicznymi wysalimy r贸wnie偶 na Tw贸j e-mail.",
    pdfEnabled: true,
    pdfType: 'generated', 
    pdfLabel: 'POBIERZ TWJ RAPORT ANALITYCZNY (PDF)',
    pdfDesc: 'Kliknij, aby pobra kopi zapasow swoich oblicze mocy i zwrotu z inwestycji.',
    navLink: '/baza-wiedzy',
    navLabel: 'Jak oszczdza na ogrzewaniu?'
  },
  chlodzenie: {
    title: "Analiza Komfortu Gotowa!",
    subtitle: "Przygotuj si na idealn temperatur.",
    desc: "Wyliczylimy moc potrzebn do skutecznego schodzenia Twojego domu. Szczeg贸y znajdziesz w raporcie poni偶ej.",
    pdfEnabled: true,
    pdfType: 'generated', 
    pdfLabel: 'POBIERZ RAPORT CHODZENIA (PDF)',
    pdfDesc: 'Pobierz podsumowanie doboru mocy i rekomendowanych modeli urzdze.',
    navLink: '/baza-wiedzy',
    navLabel: 'Wszystko o czystym powietrzu'
  },
  raport: {
    title: "Analiza Inwestycyjna Gotowa!",
    subtitle: "Twoje wyniki zostay przetworzone.",
    desc: "Poni偶ej znajdziesz podsumowanie swoich oblicze. Mo偶esz pobra je jako profesjonalny raport PDF.",
    pdfEnabled: true,
    pdfType: 'generated', 
    pdfLabel: 'POBIERZ TWJ RAPORT ANALITYCZNY (PDF)',
    pdfDesc: 'Kliknij poni偶ej, aby pobra podsumowanie oblicze.',
    navLink: '/baza-wiedzy',
    navLabel: 'Baza Wiedzy AirTUR'
  }
};
---

<Layout title="Dzikujemy | AirTUR">
  
  <section class="pt-32 pb-24 bg-white min-h-[80vh] flex items-center overflow-hidden">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      
      <div class="mb-10 inline-flex items-center justify-center">
        <div class="relative">
            <div class="absolute inset-0 bg-airtur-blue rounded-full animate-ping opacity-20"></div>
            <div class="relative bg-airtur-blue text-white p-8 rounded-full shadow-2xl">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-12 h-12">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
            </div>
        </div>
      </div>

      <div class="space-y-6 mb-16">
        <h1 id="main-title" class="text-4xl md:text-5xl lg:text-6xl font-black text-airtur-dark leading-tight tracking-tight uppercase">
            Dzikujemy!
        </h1>
        <p id="main-subtitle" class="text-xl md:text-2xl font-bold text-gray-400">
            Wiadomo zostaa wysana.
        </p>
        <p id="main-desc" class="text-lg text-gray-500 max-w-2xl mx-auto leading-relaxed">
            Zajmiemy si Twoim zgoszeniem niezwocznie.
        </p>
      </div>

      <div id="pdf-section" class="hidden mb-16 transform transition-all duration-1000">
        <div class="bg-gray-50 border-2 border-dashed border-gray-200 rounded-[3rem] p-8 md:p-12 text-left relative overflow-hidden">
            <div class="relative z-10 flex flex-col md:flex-row items-center gap-8">
                <div class="flex-grow text-center md:text-left">
                    <span class="inline-block bg-airtur-blue text-white px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest mb-4">Materiay dla Ciebie</span>
                    <h2 id="pdf-label-text" class="text-2xl font-black text-airtur-dark mb-2 leading-tight">Tw贸j dokument jest gotowy</h2>
                    <p id="pdf-desc-text" class="text-gray-500 text-sm leading-relaxed">Pobierz plik, aby zachowa kopi oblicze.</p>
                </div>
                
                <div class="flex-shrink-0">
                    <button id="download-generated-btn" class="hidden items-center gap-3 bg-airtur-dark text-white px-8 py-5 rounded-2xl font-bold hover:bg-airtur-tech transition shadow-xl uppercase text-xs tracking-widest cursor-pointer group">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-airtur-blue group-hover:translate-y-0.5 transition-transform">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                        </svg>
                        POBIERZ RAPORT PDF
                    </button>

                    <a id="download-static-link" href="#" download class="hidden items-center gap-3 bg-airtur-blue text-white px-8 py-5 rounded-2xl font-bold hover:bg-opacity-90 transition shadow-xl uppercase text-xs tracking-widest group">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 group-hover:translate-y-0.5 transition-transform">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                        </svg>
                        POBIERZ PDF
                    </a>
                </div>
            </div>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row justify-center gap-4 border-t border-gray-100 pt-12">
          <a id="dynamic-nav-link" href="/baza-wiedzy" class="px-8 py-4 rounded-xl border-2 border-airtur-blue text-airtur-blue font-bold hover:bg-airtur-blue hover:text-white transition-all text-sm uppercase tracking-widest text-center">
              Odwied藕 Baz Wiedzy
          </a>
          <a href="/" class="px-8 py-4 rounded-xl bg-airtur-dark text-white font-bold hover:bg-airtur-tech transition text-sm shadow-xl uppercase tracking-widest text-center">
              Wr贸 na stron g贸wn
          </a>
      </div>

    </div>
  </section>

</Layout>

<script define:vars={{ contents }}>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const cel = params.get('cel');
        
        // 1. Obsuga treci dynamicznej (Nag贸wki itp.)
        if (cel && contents[cel]) {
            const data = contents[cel];
            
            document.getElementById('main-title').innerText = data.title;
            document.getElementById('main-subtitle').innerText = data.subtitle;
            document.getElementById('main-desc').innerText = data.desc;

            const navLink = document.getElementById('dynamic-nav-link');
            if (navLink) {
                navLink.href = data.navLink;
                navLink.innerText = data.navLabel;
            }

            // 2. Obsuga sekcji PDF
            if (data.pdfEnabled) {
                const pdfSection = document.getElementById('pdf-section');
                const staticLink = document.getElementById('download-static-link');
                const generatedBtn = document.getElementById('download-generated-btn');

                pdfSection.classList.remove('hidden');
                pdfSection.classList.add('animate-fade-in-up');
                document.getElementById('pdf-label-text').innerText = data.pdfLabel;
                document.getElementById('pdf-desc-text').innerText = data.pdfDesc;

                //  NOWO: Auto-scroll do sekcji PDF po 1 sekundzie
                setTimeout(() => {
                    pdfSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 1000);

                if (data.pdfType === 'generated') {
                    // Pobieranie PDF z pamici (sessionStorage) zapisanego w Konwersja.astro
                    const pdfBase64 = sessionStorage.getItem('currentReportPdf');
                    const pdfFilename = sessionStorage.getItem('currentReportFilename');

                    if (pdfBase64) {
                        generatedBtn.style.display = 'inline-flex';
                        generatedBtn.innerText = "POBIERZ RAPORT PDF";
                        
                        generatedBtn.addEventListener('click', () => {
                            const linkSource = `data:application/pdf;base64,${pdfBase64}`;
                            const downloadLink = document.createElement("a");
                            downloadLink.href = linkSource;
                            downloadLink.download = pdfFilename || 'Raport_AirTUR.pdf';
                            downloadLink.click();
                        });
                    } else {
                        // Failover: Jeli PDF nie dotar lub sesja wygasa
                        generatedBtn.style.display = 'inline-flex';
                        generatedBtn.innerText = "RAPORT WYSANO NA EMAIL";
                        generatedBtn.disabled = true;
                        generatedBtn.style.opacity = "0.5";
                        generatedBtn.style.cursor = "default";
                    }
                } else {
                    // Link statyczny (dla checklist itp.)
                    staticLink.style.display = 'inline-flex';
                    staticLink.href = `/do-pobrania/${data.pdfFile}`;
                }
            }
        }
    });
</script>

<style>
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out forwards;
  }
</style>