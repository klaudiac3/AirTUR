---
// src/pages/podziekowanie.astro
import Layout from '../layouts/Layout.astro';
import { companyConfig } from '../data/companyConfig';

// KONFIGURACJA STRATEGII DLA AIRTUR
const contents = {
  kontakt: {
    title: "Dziękujemy za kontakt!",
    subtitle: "Twoje zapytanie jest już w analizie.",
    desc: "Nasz specjalista skontaktuje się z Tobą w wybranej przez Ciebie formie w ciągu maksymalnie 24 godzin roboczych.",
    pdfEnabled: true, 
    pdfType: 'static', 
    pdfFile: 'checklista-inwestora-airtur.pdf', 
    pdfLabel: 'Checklista Świadomego Inwestora: 7 pytań, które musisz zadać instalatorowi',
    pdfDesc: 'Zanim podejmiesz ostateczną decyzję, sprawdź o co warto zapytać, aby uniknąć błędów.',
    navLink: '/baza-wiedzy',
    navLabel: 'Odwiedź Bazę Wiedzy'
  },
  montaz: {
    title: "Zgłoszenie montażu przyjęte",
    subtitle: "Rozpoczynamy przygotowanie audytu.",
    desc: "Dziękujemy za zaufanie. Inżynier techniczny oddzwoni do Ciebie, aby umówić bezpłatną wizję lokalną i omówić szczegóły instalacji.",
    pdfEnabled: true,
    pdfType: 'static',
    pdfFile: 'przewodnik-audyt-techniczny.pdf', 
    pdfLabel: 'Pobierz: Jak przygotować dom do montażu? (PDF)',
    pdfDesc: 'Krótki poradnik o tym, gdzie najlepiej umieścić jednostki przed naszą wizytą.',
    navLink: '/narzedzia',
    navLabel: 'Oblicz oszczędności w Narzędziach'
  },
  serwis: {
    title: "Zgłoszenie serwisowe zarejestrowane",
    subtitle: "Twój komfort jest naszym priorytetem.",
    desc: "Przyjęliśmy prośbę o serwis. Technik odpowiedzialny za Twój region skontaktuje się z Tobą, aby ustalić dogodny termin wizyty.",
    pdfEnabled: false,
    pdfType: 'static',
    pdfFile: '', 
    pdfLabel: '',
    pdfDesc: '',
    navLink: '/baza-wiedzy',
    navLabel: 'Jak dbać o klimatyzację? (Blog)'
  },
  raport: {
    title: "Analiza Inwestycyjna Gotowa!",
    subtitle: "Twoje wyniki zostały przetworzone pomyślnie.",
    desc: "Poniżej znajdziesz podsumowanie swoich obliczeń. Możesz pobrać je jako profesjonalny raport PDF, który pomoże Ci w podjęciu decyzji.",
    pdfEnabled: true,
    pdfType: 'generated', 
    pdfFile: 'analiza-inwestycyjna-airtur.pdf',
    pdfLabel: 'POBIERZ TWÓJ RAPORT ANALITYCZNY (PDF)',
    pdfDesc: 'Kliknij poniżej, aby od razu pobrać podsumowanie Twoich obliczeń mocy i oszczędności.',
    navLink: '/baza-wiedzy',
    navLabel: 'Dowiedz się więcej w Bazie Wiedzy'
  }
};
---

<Layout title="Dziękujemy za kontakt | AirTUR">
  <section class="pt-32 pb-24 bg-white min-h-[80vh] flex items-center overflow-hidden">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      
      <!-- 1. IKONA SUKCESU -->
      <div class="mb-10 inline-flex items-center justify-center">
        <div class="relative">
            <div class="absolute inset-0 bg-airtur-blue rounded-full animate-ping opacity-20"></div>
            <div id="icon-box" class="relative bg-airtur-blue text-white p-8 rounded-full shadow-2xl">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-12 h-12">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
            </div>
        </div>
      </div>

      <!-- 2. TREŚĆ DYNAMICZNA -->
      <div class="space-y-6 mb-16">
        <h1 id="main-title" class="text-4xl md:text-5xl lg:text-6xl font-black text-airtur-dark leading-tight tracking-tight text-balance uppercase">
            Dziękujemy!
        </h1>
        <p id="main-subtitle" class="text-xl md:text-2xl font-bold text-gray-400">
            Zajmiemy się tym niezwłocznie.
        </p>
        <p id="main-desc" class="text-lg text-gray-500 max-w-2xl mx-auto leading-relaxed">
            Wiadomość została wysłana poprawnie.
        </p>
      </div>

      <!-- 3. DYNAMICZNA SEKCJA PDF -->
      <div id="pdf-section" class="hidden mb-16 transform transition-all duration-1000">
        <div class="bg-gray-50 border-2 border-dashed border-gray-200 rounded-[3rem] p-8 md:p-12 text-left relative overflow-hidden">
            <div class="relative z-10 flex flex-col md:flex-row items-center gap-8">
                <div class="flex-grow text-center md:text-left">
                    <span class="inline-block bg-airtur-blue text-white px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest mb-4">Materiały dla Ciebie</span>
                    <h2 id="pdf-label-text" class="text-2xl font-black text-airtur-dark mb-2 leading-tight">---</h2>
                    <p id="pdf-desc-text" class="text-gray-500 text-sm leading-relaxed">---</p>
                </div>
                
                <div class="flex-shrink-0">
                    <!-- PRZYCISK DLA GENERATORA -->
                    <button id="download-generated-btn" class="hidden items-center gap-3 bg-airtur-dark text-white px-8 py-5 rounded-2xl font-bold hover:bg-airtur-tech transition shadow-xl uppercase text-xs tracking-widest whitespace-nowrap cursor-pointer group">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-airtur-blue group-hover:translate-y-0.5 transition-transform">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                        </svg>
                        GENERUJ I POBIERZ
                    </button>

                    <!-- LINK DLA PLIKÓW STATYCZNYCH -->
                    <a id="download-static-link" href="#" download class="hidden items-center gap-3 bg-airtur-blue text-white px-8 py-5 rounded-2xl font-bold hover:bg-opacity-90 transition shadow-xl uppercase text-xs tracking-widest whitespace-nowrap group cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 group-hover:translate-y-0.5 transition-transform">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                        </svg>
                        POBIERZ PDF
                    </a>
                </div>
            </div>
        </div>
      </div>

      <!-- 4. NAWIGACJA -->
      <div class="flex flex-col sm:flex-row justify-center gap-4 border-t border-gray-100 pt-12">
          <a id="dynamic-nav-link" href="/baza-wiedzy" class="px-8 py-4 rounded-xl border-2 border-airtur-blue text-airtur-blue font-bold hover:bg-airtur-blue hover:text-white transition-all text-sm uppercase tracking-widest text-center">
              Odwiedź Bazę Wiedzy
          </a>
          <a href="/" class="px-8 py-4 rounded-xl bg-airtur-dark text-white font-bold hover:bg-airtur-tech transition text-sm shadow-xl uppercase tracking-widest text-center">
              Wróć na stronę główną
          </a>
      </div>

    </div>
  </section>

  <!-- ======================================================== -->
  <!-- UKRYTY SZABLON PDF (BEZ DISPLAY: NONE DLA POPRAWNEGO RENDEROWANIA) -->
  <!-- ======================================================== -->
  <div id="pdf-wrapper" style="position: absolute; left: -9999px; top: 0; width: 800px; background: white;">
      <div id="pdf-template" class="p-16 bg-white text-airtur-dark font-sans" style="width: 800px; min-height: 1100px;">
          <div class="flex justify-between items-start border-b-8 border-airtur-blue pb-10 mb-12">
              <div>
                  <img src="/logo.svg" alt="AirTUR Logo" class="h-16 mb-4" />
                  <h1 class="text-4xl font-black uppercase tracking-tighter leading-none">Analiza<br/>Inwestycyjna</h1>
                  <p class="text-airtur-blue font-bold tracking-[0.3em] text-[10px] mt-2 uppercase">Ekspertyza Techniczna AirTUR</p>
              </div>
              <div class="text-right">
                  <p class="font-black text-xl text-airtur-dark uppercase">{companyConfig.fullName}</p>
                  <p class="text-xs text-gray-500 leading-relaxed italic">{companyConfig.address.full}</p>
                  <div class="mt-4 bg-gray-100 px-4 py-2 rounded-lg inline-block">
                      <p class="text-[10px] font-bold text-gray-400 uppercase">Data wygenerowania:</p>
                      <p class="text-sm font-bold text-airtur-dark" id="pdf-date">--.--.----</p>
                  </div>
              </div>
          </div>

          <div class="mb-12">
              <div class="flex items-center gap-3 mb-6">
                  <div class="w-8 h-8 bg-airtur-dark text-white flex items-center justify-center rounded-lg font-black">01</div>
                  <h2 class="text-xl font-black uppercase tracking-tight">Parametry Pomieszczenia</h2>
              </div>
              <div class="grid grid-cols-2 gap-8 ml-11">
                  <div class="bg-gray-50 p-6 rounded-2xl border border-gray-100">
                      <p class="text-[10px] text-gray-400 uppercase font-black tracking-widest mb-1">Powierzchnia:</p>
                      <p class="text-2xl font-black"><span class="pdf-data-area">---</span> m²</p>
                  </div>
                  <div class="bg-gray-50 p-6 rounded-2xl border border-gray-100">
                      <p class="text-[10px] text-gray-400 uppercase font-black tracking-widest mb-1">Cel Inwestycji:</p>
                      <p class="text-2xl font-black uppercase"><span class="pdf-data-goal">---</span></p>
                  </div>
              </div>
          </div>

          <div class="mb-12">
              <div class="flex items-center gap-3 mb-6">
                  <div class="w-8 h-8 bg-airtur-dark text-white flex items-center justify-center rounded-lg font-black">02</div>
                  <h2 class="text-xl font-black uppercase tracking-tight">Rekomendacja Mocy</h2>
              </div>
              <div class="ml-11 bg-airtur-dark text-white p-10 rounded-[3rem] shadow-xl relative overflow-hidden">
                  <div class="relative z-10 flex justify-between items-center">
                      <div>
                        <p class="text-airtur-blue font-black text-xs uppercase tracking-widest mb-2">Wyliczone zapotrzebowanie:</p>
                        <div class="flex items-baseline gap-2">
                            <span class="text-7xl font-black pdf-data-power">---</span>
                            <span class="text-3xl font-bold text-airtur-blue">kW</span>
                        </div>
                      </div>
                  </div>
              </div>
          </div>

          <div class="mb-12">
              <div class="flex items-center gap-3 mb-6">
                  <div class="w-8 h-8 bg-airtur-dark text-white flex items-center justify-center rounded-lg font-black">03</div>
                  <h2 class="text-xl font-black uppercase tracking-tight">Sugerowany Sprzęt</h2>
              </div>
              <div class="ml-11 border-2 border-gray-100 p-8 rounded-[2.5rem] bg-white">
                  <p class="text-airtur-blue font-black text-2xl mb-2 pdf-data-model">Dobrany Model...</p>
                  <p class="text-gray-500 text-sm leading-relaxed">Model dobrany technicznie do Twoich potrzeb.</p>
              </div>
          </div>

          <div class="mb-12">
              <div class="flex items-center gap-3 mb-6">
                  <div class="w-8 h-8 bg-airtur-dark text-white flex items-center justify-center rounded-lg font-black">04</div>
                  <h2 class="text-xl font-black uppercase tracking-tight">Oszczędności Roczne</h2>
              </div>
              <div class="ml-11 bg-green-50 border-2 border-green-100 p-10 rounded-[3rem] text-center">
                   <p class="text-[10px] text-green-600 font-black uppercase tracking-[0.2em] mb-2">Możesz zaoszczędzić nawet:</p>
                   <div class="flex justify-center items-baseline gap-2 text-green-600">
                       <span class="text-6xl font-black pdf-data-savings">---</span>
                       <span class="text-2xl font-bold uppercase">Zł / Rok</span>
                   </div>
              </div>
          </div>

          <div class="absolute bottom-16 left-16 right-16 pt-8 border-t border-gray-100 flex justify-between items-end">
              <div class="text-[9px] text-gray-400 max-w-sm">
                  <p class="font-bold text-airtur-dark uppercase mb-1">Nota prawna:</p>
                  <p>Prezentowana analiza ma charakter szacunkowy. Wiążąca oferta zostanie potwierdzona przez specjalistę AirTUR.</p>
              </div>
              <div class="text-right text-[10px] text-gray-400">
                  <p class="font-black text-airtur-dark text-sm uppercase">AirTUR.pl</p>
                  <p>Inżynieria Komfortu</p>
              </div>
          </div>
      </div>
  </div>
</Layout>

<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script define:vars={{ contents }}>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const cel = params.get('cel');
        
        const area = params.get('area') || '---';
        const power = params.get('power') || '---';
        const goal = params.get('goal') || 'Analiza';
        const savings = params.get('savings') || '---';
        const model = params.get('model') || 'Model Premium AirTUR';

        if (cel && contents[cel]) {
            const data = contents[cel];
            
            document.getElementById('main-title').innerText = data.title;
            document.getElementById('main-subtitle').innerText = data.subtitle;
            document.getElementById('main-desc').innerText = data.desc;

            const navLink = document.getElementById('dynamic-nav-link');
            if (navLink) {
                navLink.href = data.navLink;
                navLink.innerText = data.navLabel;
            }

            const isSectionValid = data.pdfEnabled && (data.pdfType === 'generated' || (data.pdfFile && data.pdfFile.trim() !== ''));

            if (isSectionValid) {
                const pdfSection = document.getElementById('pdf-section');
                const pdfLabelText = document.getElementById('pdf-label-text');
                const pdfDescText = document.getElementById('pdf-desc-text');
                const staticLink = document.getElementById('download-static-link');
                const generatedBtn = document.getElementById('download-generated-btn');

                if (pdfSection) {
                    pdfLabelText.innerText = data.pdfLabel;
                    pdfDescText.innerText = data.pdfDesc;
                    
                    staticLink.style.display = 'none';
                    generatedBtn.style.display = 'none';
                    
                    setTimeout(() => {
                        pdfSection.classList.remove('hidden');
                        pdfSection.classList.add('animate-fade-in-up');
                    }, 200);

                    if (data.pdfType === 'generated') {
                        generatedBtn.style.display = 'inline-flex';

                        const dateEl = document.getElementById('pdf-date');
                        if(dateEl) dateEl.innerText = new Date().toLocaleDateString('pl-PL');
                        document.querySelectorAll('.pdf-data-area').forEach(el => el.innerText = area);
                        document.querySelectorAll('.pdf-data-power').forEach(el => el.innerText = power);
                        document.querySelectorAll('.pdf-data-goal').forEach(el => el.innerText = goal);
                        document.querySelectorAll('.pdf-data-savings').forEach(el => el.innerText = savings);
                        document.querySelectorAll('.pdf-data-model').forEach(el => el.innerText = model);

                        generatedBtn.addEventListener('click', () => {
                            const element = document.getElementById('pdf-template');
                            const opt = {
                                margin: 0,
                                filename: `Analiza_AirTUR_${area}m2.pdf`,
                                image: { type: 'jpeg', quality: 0.98 },
                                html2canvas: { 
                                    scale: 2, 
                                    useCORS: true,
                                    logging: false,
                                    letterRendering: true
                                },
                                jsPDF: { unit: 'px', format: [800, 1131], orientation: 'portrait' }
                            };
                            
                            generatedBtn.innerText = "GENEROWANIE...";
                            generatedBtn.disabled = true;

                            // Małe opóźnienie dla stabilności renderowania
                            setTimeout(() => {
                                html2pdf().set(opt).from(element).save().then(() => {
                                    generatedBtn.innerText = "POBIERZ PONOWNIE";
                                    generatedBtn.disabled = false;
                                }).catch(err => {
                                    console.error("PDF Error:", err);
                                    generatedBtn.innerText = "BŁĄD GENEROWANIA";
                                    generatedBtn.disabled = false;
                                });
                            }, 500);
                        });
                    } else {
                        staticLink.style.display = 'inline-flex';
                        staticLink.href = `/do-pobrania/${data.pdfFile}`;
                    }
                }
            }
        }
    });
</script>

<style>
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out forwards;
  }
  #pdf-template {
    font-family: 'Inter', sans-serif;
  }
</style>